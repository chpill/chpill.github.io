<!DOCTYPE html>
<html><head><title>Running a command-line tool in a clean environment</title><meta charset="utf-8" /><link href="/assets/pandoc-gfm.css" rel="stylesheet" /></head><body><header><nav><p><span style="padding-right:2rem;">Chpill&apos;s (Over) Engineering Log</span><a href="/">about</a> - <a href="/en/posts">posts</a> - <a href="/en/feed.xml">feed</a></p></nav></header><main><h1>Running a command-line tool in a clean environment</h1><p><i>2025-01-29</i></p><p><strong>TLDR</strong>: Use
<code>env -i &lt;command and its arguments&gt;</code> to run a command
without the environment variables from your current shell.</p>
<p>I was manually doing some maintenance on some remote Linux servers at
work, and one of the thing I had to do was to disable password
authentication, to make sure they were only accessible if you had your
SSH public key in there. This is very easy to do:</p>
<ul>
<li>set <code>PasswordAuthentication no</code> in
/etc/ssh/sshd_config</li>
<li>Enable the new configuration <code>systemctl restart ssh</code></li>
</ul>
<p>But I also wanted to test that it was producing the intented effect,
by trying to SSH in via password, see it succeed, and then fail after
the new settings are enabled. For the first server, I actually kept
switching on and off identities in my ssh-agent, which was quite
tedious. For this specific case, SSH has an option to make it ignore the
agent (<code>-o IdentityAgent=none</code>), but there is in fact a more
generally applicable solution to this problem, using <code>env</code>
from <a
href="https://www.gnu.org/software/coreutils/manual/html_node/env-invocation.html#env_003a-Run-a-command-in-a-modified-environment">GNU
coreutils</a>: <code>env -i ssh &lt;remote-user-and-host&gt;</code>.</p>
<p>I had only ever used <code>env</code> to see my current environment
variables, and, funnily enough, a great way to demonstrate what
<code>env -i</code> does is to run <code>env -i env</code>, which will
output nothing. Hurray!</p>
</main><footer style="margin-top:3rem;text-align:center;"><hr /><p><small>Made with <a href="https://pandoc.org/">Pandoc</a></small></p></footer></body></html>